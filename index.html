<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>CRUD Sederhana (HTML)</title>
</head>
<body>

  <!-- Judul utama halaman -->
  <h1>Data Mahasiswa â€” CRUD Sederhana</h1>

  <!-- FORM INPUT MAHASISWA -->
  <form id="form-mahasiswa" autocomplete="off">

    <!-- Input Nama Mahasiswa -->
    <div>
      <label for="nama">Nama:</label>
      <input type="text" id="nama" required placeholder="Masukkan nama">
    </div>

    <!-- Input NIM Mahasiswa -->
    <div>
      <label for="nim">NIM:</label>
      <input type="text" id="nim" required placeholder="Masukkan NIM">
    </div>

    <!-- Hidden input untuk ID mahasiswa saat edit -->
    <input type="hidden" id="id">

    <!-- Tombol Aksi Form -->
    <div>
      <button type="submit" id="btn-simpan">Simpan</button>
      <button type="button" id="btn-reset">Reset</button>
    </div>
  </form>

  <!-- Tabel untuk menampilkan data mahasiswa -->
  <h2>Daftar Mahasiswa</h2>
  <table border="1" cellpadding="5">
    <thead>
      <tr>
        <th>#</th>
        <th>Nama</th>
        <th>NIM</th>
        <th>Aksi</th>
      </tr>
    </thead>
    <tbody id="tbody">
      <!-- Baris tabel akan dirender melalui JavaScript -->
    </tbody>
  </table>

  <!-- SCRIPT JAVASCRIPT CRUD -->
  <script>
    // ------------------- PERSISTENSI DATA -------------------
    const STORAGE_KEY = "crud_mahasiswa"; // Key localStorage

    // Load data dari localStorage, jika kosong kembalikan array kosong
    const loadData = () => JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");

    // Simpan array data ke localStorage
    const saveData = (list) => localStorage.setItem(STORAGE_KEY, JSON.stringify(list));

    // ------------------- STATE -------------------
    let data = loadData(); // Array data mahasiswa
    let autoId = data.reduce((m, o) => Math.max(m, o.id), 0) + 1; // Auto-increment ID

    // ------------------- ELEMENT HTML -------------------
    const form = document.getElementById("form-mahasiswa");
    const elId = document.getElementById("id");
    const elNama = document.getElementById("nama");
    const elNim = document.getElementById("nim");
    const tbody = document.getElementById("tbody");
    const btnReset = document.getElementById("btn-reset");

    // ------------------- FUNGSI RENDER -------------------
    function render() {
      if (!Array.isArray(data)) data = [];
      tbody.innerHTML = ""; // Kosongkan tabel sebelum render ulang
      data.forEach((row, idx) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${idx + 1}</td>
          <td>${row.nama}</td>
          <td>${row.nim}</td>
          <td>
            <button type="button" data-edit="${row.id}">Edit</button>
            <button type="button" data-del="${row.id}">Hapus</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    // ------------------- FORM SUBMIT (CREATE / UPDATE) -------------------
    form.addEventListener("submit", (e) => {
      e.preventDefault(); // Mencegah reload halaman

      const idVal = elId.value.trim();
      const nama = elNama.value.trim();
      const nim = elNim.value.trim();

      if (!nama || !nim) return alert("Nama dan NIM wajib diisi.");

      if (idVal) {
        // UPDATE DATA
        const idNum = Number(idVal);
        const idx = data.findIndex(x => x.id === idNum);
        if (idx >= 0) {
          data[idx].nama = nama;
          data[idx].nim = nim;
        }
      } else {
        // CREATE DATA BARU
        data.push({ id: autoId++, nama, nim });
      }

      saveData(data); // Simpan data
      render();       // Render ulang tabel
      form.reset();   // Reset form
      elId.value = ""; 
      elNama.focus(); // Fokus ke input nama
    });

    // ------------------- RESET FORM -------------------
    btnReset.addEventListener("click", () => {
      form.reset();
      elId.value = "";
      elNama.focus();
    });

    // ------------------- HANDLER TOMBOL EDIT / HAPUS -------------------
    tbody.addEventListener("click", (e) => {
      const editId = e.target.getAttribute("data-edit");
      const delId = e.target.getAttribute("data-del");

      if (editId) {
        // EDIT DATA
        const item = data.find(x => x.id === Number(editId));
        if (item) {
          elId.value = item.id;
          elNama.value = item.nama;
          elNim.value = item.nim;
          elNama.focus();
        }
      }

      if (delId) {
        // DELETE DATA
        const idNum = Number(delId);
        if (confirm("Yakin hapus data ini?")) {
          data = data.filter(x => x.id !== idNum);
          saveData(data);
          render();
        }
      }
    });

    // ------------------- INIT -------------------
    render(); // Render tabel saat halaman pertama kali dibuka
  </script>
</body>
</html>
